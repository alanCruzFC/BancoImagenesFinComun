<div class="p-6 min-h-screen bg-gray-50 flex flex-col shadow-lg border border-gray-200 rounded-2xl">
  <!-- Encabezado con b√∫squeda -->
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold bg-linear-to-r from-[#046CAC] to-[#046BB4] bg-clip-text text-transparent">
      API Keys registradas
    </h2>

    <!-- Barra de b√∫squeda + bot√≥n -->
    <div class="flex items-center gap-3">
      <input [(ngModel)]="searchTerm"
             (input)="filtrarApiKeys()"
             type="text"
             placeholder="üîç Buscar..."
             autocomplete="off"
             aria-label="Buscar API Keys"
             class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#046CAC]" />
      <button (click)="abrirModalApiKey()" *ngIf="puedeSubir()"
              class="bg-linear-to-r from-[#046BB4] to-[#4484B4] text-white py-3 px-4 rounded-lg font-semibold
                 shadow-md hover:shadow-glow transform transition-all duration-300
                 hover:scale-[1.05] active:scale-[0.95]
                 focus:outline-none focus:ring-2 focus:ring-[#046BB4] focus:ring-offset-2
                 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
        ‚ûï Nueva ApiKey
      </button>
    </div>
  </div>

  <!-- Tabla -->
  <div class="flex-1 overflow-x-auto rounded-xl shadow-lg bg-white/80 backdrop-blur-sm border border-white/20">
    <table class="table-auto w-full text-sm">
      <thead>
        <tr class="bg-linear-to-r from-[#046BB4]/10 to-[#4484B4]/10">
          <th class="px-2 py-2 text-left font-semibold text-[#046CAC]">Id</th>
          <th class="px-2 py-2 text-left font-semibold text-[#046CAC]">Consumidor</th>
          <th class="px-2 py-2 text-left font-semibold text-[#046CAC]">Clave</th>
          <th class="px-2 py-2 text-center font-semibold text-[#046CAC]">Activo</th>
          <th class="px-2 py-2 text-center font-semibold text-[#046CAC]">Lectura</th>
          <th class="px-2 py-2 text-center font-semibold text-[#046CAC]">Escritura</th>
          <th class="px-2 py-2 text-center font-semibold text-[#046CAC]">Actualizaci√≥n</th>
          <th class="px-2 py-2 text-center font-semibold text-[#046CAC]">Eliminaci√≥n</th>
          <th class="px-2 py-2 text-center font-semibold text-[#046CAC]">Fecha creaci√≥n</th>
          <th *ngIf="puedeSubir()" class="px-2 py-2 text-center font-semibold text-[#046CAC]">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        <tr *ngFor="let key of apikeysFiltradas"
            class="hover:bg-linear-to-r hover:from-[#046BB4]/5 hover:to-transparent transition-all duration-200">
          <td class="px-2 py-2 font-medium text-[#046CAC]">{{ key.id }}</td>
          <td class="px-2 py-2">{{ key.consumidor }}</td>
          <td class="px-2 py-2">
            <span class="font-mono">
              {{ claveVisible[key.id] ? key.clave : '************' }}
            </span>
            <button (click)="toggleClave(key.id)"
                    class="ml-2 text-blue-600 hover:underline text-xs">
              {{ claveVisible[key.id] ? 'Ocultar' : 'Ver clave' }}
            </button>
          </td>
          <td class="px-2 py-2 text-center">
            <span [ngClass]="key.activo ? 'text-green-600' : 'text-red-600'">
              {{ key.activo ? '‚úîÔ∏è Activa' : '‚ùå Inactiva' }}
            </span>
          </td>
          <td class="px-2 py-2 text-center">
            <span [ngClass]="key.lectura ? 'text-green-600' : 'text-red-600'">
              {{ key.lectura ? 'SI' : 'NO' }}
            </span>
          </td>
          <td class="px-2 py-2 text-center">
            <span [ngClass]="key.escritura ? 'text-green-600' : 'text-red-600'">
              {{ key.escritura ? 'SI' : 'NO' }}
            </span>
          </td>
          <td class="px-2 py-2 text-center">
            <span [ngClass]="key.actualizacion ? 'text-green-600' : 'text-red-600'">
              {{ key.actualizacion ? 'SI' : 'NO' }}
            </span>
          </td>
          <td class="px-2 py-2 text-center">
            <span [ngClass]="key.eliminacion ? 'text-green-600' : 'text-red-600'">
              {{ key.eliminacion ? 'SI' : 'NO' }}
            </span>
          </td>
          <td class="px-2 py-2 text-center">
            {{ key.fechaCreacion ? (key.fechaCreacion | date:'dd/MM/yyyy HH:mm') : '‚Äî' }}
          </td>

          <td *ngIf="puedeSubir()" class="px-2 py-2 text-center space-x-2"> 
            <button (click)="abrirModalApiKey(key)" aria-label="Editar API Key {{ key.id }}" class="text-yellow-600 hover:underline text-xs"> ‚úèÔ∏è </button> 
            <button (click)="borrarApiKey(key.id)" aria-label="Eliminar API Key {{ key.id }}" class="text-red-600 hover:underline text-xs"> üóëÔ∏è </button> 
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div *ngIf="modalVisibleApikey"
      class="fixed inset-0 bg-white/30 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-[500px] relative overflow-hidden">
      <div class="bg-linear-to-r from-[#046BB4] to-[#4484B4] p-6 text-white">
        <button (click)="cerrarModalApiKey()" aria-label="Cerrar modal API Key"
                class="absolute top-3 right-3 z-50 bg-gray-200 text-gray-700 hover:bg-gray-300 rounded-full p-2 shadow-md transition">‚úñ</button>
        <h3 class="text-lg font-bold">
          {{ apikeySeleccionada ? 'Actualizar API Key' : 'Crear nueva API Key' }}
        </h3>
        <p class="text-white/80 text-sm">
          {{ apikeySeleccionada ? 'Modifica los datos y refactoriza la clave si lo requieres' : 'Completa los datos de la nueva API Key' }}
        </p>
      </div>
      <div class="p-6">
        <app-formulario-apikey
          [apiKey]="apikeySeleccionada"
          (creado)="cerrarModalApiKey(); ngOnInit()">
        </app-formulario-apikey>
      </div>
    </div>
  </div>
</div>
